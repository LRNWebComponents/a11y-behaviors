<!--
`schema-behaviors`
A behavior for mixing-in schema and common schema operations.

@microcopy - the mental model for this element
 - schema - metadata model to provide machine wiring to webcomponents.

-->
<script>
  // ensure SchemaBehaviors exists
  window.SchemaBehaviors = window.SchemaBehaviors || {};

  window.SchemaBehaviors.Schema = {
    properties: {
      /**
       * Unique Schema ID
       */
      schemaGuid: {
        type: String,
        computed: '_computeSchemaGuid()',
      },
      /**
       * Schema Map for this element.
       */
      schemaMap: {
        type: Object,
        value: {
          "prefix": {
            "oer": "http://oerschema.org/",
            "schema": "http://schema.org/",
            "dc": "http://purl.org/dc/terms/",
            "foaf": "http://xmlns.com/foaf/0.1/",
            "cc": "http://creativecommons.org/ns#",
            "bib": "http://bib.schema.org",
          },
        },
        observer: "_schemaMapChanged",
      },
    },
    /**
     * Compute schema GUID
     */
    _computeSchemaGuid: function() {
      let guid = this.generateGUID();
      this.setAttribute('resource', guid);
      return this.generateGUID();
    },
    /**
     * Generate a uinque ID
     */
    generateGUID: function() {
      function idPart() {
        return Math.floor((1 + Math.random()) * 0x10000)
          .toString(16)
          .substring(1);
      }
      return '#' + idPart() + idPart() + '-' + idPart() + '-' + idPart() + '-' +
        idPart();
    },
    /**
     * Notice the schema map has changed, reprocess attributes.
     */
    _schemaMapChanged: function(newValue, oldValue) {
      if (typeof newValue !== typeof undefined) {
        let prefixes = newValue.prefix;
        let prefix = '';
        // build prefix string
        for (var property in prefixes) {
          if (properties.hasOwnProperty(property)) {
            prefix += property + ':' + properties[property] + ' ';
          }
        }
        // set prefix on the main element itself
        if (prefix != '') {
          this.setAttribute("prefix", prefix);
        }
      }
    }
  };
</script>